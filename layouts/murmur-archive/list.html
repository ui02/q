{{ define "main" }}

{{/* murmur セクションのページのみ取得 */}}
{{ $allPages := where .Site.RegularPages "Section" "murmur" }}
{{ $allPages = where $allPages "Date" "ne" nil | sort "Date" "desc" }}

{{/* 年-月ごとにグループ化 */}}
{{ $months := dict }}
{{ range $allPages }}
  {{ $ym := .Date.Format "2006-01" }}
  {{ $monthPages := index $months $ym | default (slice) }}
  {{ $months = merge $months (dict $ym (append $monthPages .)) }}
{{ end }}

{{/* 月リンク一覧 */}}
<div class="month-links">
  {{ range $ym, $_ := $months }}
    <a href="#{{ $ym }}">{{ $ym }}</a>
  {{ end }}
</div>

{{/* 月ごとにページネーション */}}
{{ range $ym, $pages := $months }}
  <h2 id="{{ $ym }}">{{ $ym }}</h2>

  {{ $paginator := $.Paginate $pages 10 }} {{/* 1ページに10件表示 */}}

  {{ range $paginator.Pages }}
    <div class="card">
      {{/* 複数画像を一括表示 */}}
      {{ range .Resources.Match "images/*" }}
        <img src="{{ .RelPermalink }}" alt="">
      {{ end }}
      <div class="text">
        <p>{{ .Plain }}</p>
        <small>{{ .Date.Format "2006/01/02 15:04" }}</small>
      </div>
    </div>
  {{ end }}

  {{/* ページネーションリンク */}}
  <div class="pagination">
    {{ if $paginator.HasPrev }}
      <a href="{{ $paginator.Prev.URL }}">Prev</a>
    {{ end }}
    {{ if $paginator.HasNext }}
      <a href="{{ $paginator.Next.URL }}">Next</a>
    {{ end }}
  </div>
{{ end }}

{{ end }}
